<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebCam Capture</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Welcome to the WebCam Capture Page</h1>
    <button id="capture-button">Capture</button>
    <img id="captured-image" src="" alt="Captured image" style="display:block;">
    <div id="image-info" style="display:block;"></div>
    <div id="rename-form" style="display:block;">
        <input type="text" id="new-image-name" placeholder="New Image Name">
        <button id="rename-button">Rename</button>
    </div>
    <div id="image-list"></div>
    <script>
        async function listImages() {
            const imageList = document.getElementById('image-list');
            imageList.innerHTML = '';
            try {
                const response = await fetch('/cgi-bin/webcam.cgi?list');
                const imageNames = await response.json();
                for (const imageName of imageNames) {
                    const link = document.createElement('a');
                    link.href = `/images/${imageName}`;
                    link.innerText = imageName;
                    link.target = '_blank';
                    imageList.appendChild(link);
                    imageList.appendChild(document.createElement('br'));
                }
            } catch (error) {
                console.error("Error fetching image list:", error);
            }
        }
        document.getElementById('capture-button').addEventListener('click', async () => {
            const button = document.getElementById('capture-button');
            const imgElement = document.getElementById('captured-image');
            const infoElement = document.getElementById('image-info');
            const renameForm = document.getElementById('rename-form');
            button.disabled = true;
            try {
                const response = await fetch('/cgi-bin/webcam.cgi?capture');
                const imageName = await response.text();
                const imageUrl = `/images/${imageName}`;
                imgElement.src = imageUrl;
                imgElement.style.display = 'block';
                infoElement.innerHTML = `Image Name: ${imageName}`;
                infoElement.style.display = 'block';
                renameForm.style.display = 'block';
                await listImages();
            } catch (error) {
                console.error("Error fetching the image:", error);
            } finally {
                button.disabled = false;
            }
        });

        document.getElementById('rename-button').addEventListener('click', async () => {
            const currentImageName = document.getElementById('image-info').innerText.replace('Image Name: ', '');
            const newImageName = document.getElementById('new-image-name').value;
            if (newImageName === '') {
                alert('Please enter a new image name.');
                return;
            }
            try {
                const response = await fetch(`/cgi-bin/webcam.cgi?rename&oldName=${currentImageName}&newName=${newImageName}`);
                const result = await response.text();
                if (result === 'success') {
                    document.getElementById('image-info').innerHTML = `Image Name: ${newImageName}`;
                    document.getElementById('new-image-name').value = '';
                    await listImages();
                } else {
                    alert('Error renaming the image.');
                }
            } catch (error) {console.error("Error renaming the image:", error);
        }
    });

    listImages();
</script>
</body>
</html>
